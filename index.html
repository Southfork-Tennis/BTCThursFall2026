<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BTC Admin — Score Entry</title>
  <style>
    :root { --bg: #f8fafc; --accent: #2563eb; --text: #1e293b; --border: #cbd5e1; }
    body { font-family: system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; }
    .wrap { max-width: 600px; margin: 0 auto; padding: 1.5rem; }
    header { background: #fff; padding: 1rem; border-bottom: 2px solid var(--accent); font-weight: 800; color: var(--accent); text-align: center; }
    .card { background: white; padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 1rem; }
    label { display: block; font-size: 0.75rem; font-weight: 700; color: #64748b; text-transform: uppercase; margin-bottom: 0.5rem; }
    select, input { width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid var(--border); margin-bottom: 1rem; font-size: 1rem; }
    .score-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; padding: 0.5rem 0; border-bottom: 1px solid #f1f5f9; }
    .btn { width: 100%; padding: 1rem; border-radius: 8px; border: none; font-weight: 700; cursor: pointer; background: var(--accent); color: white; }
  </style>
</head>
<body>
<header>BTC ADMIN PORTAL</header>
<div class="wrap">
  <div id="gateArea" class="card">
    <label>Access Code</label>
    <input type="password" id="gateCode" placeholder="••••">
    <button class="btn" id="btnUnlock">Unlock</button>
  </div>
  <div id="adminArea" hidden>
    <div class="card">
      <label>Match Selection</label>
      <select id="roundSelect"></select>
      <select id="matchSelect"></select>
      <button class="btn" id="btnLoad">Load Match</button>
    </div>
    <div id="sheetHost"></div>
  </div>
</div>
<script>
const SHEETS_WEBAPP_URL = "https://script.google.com/macros/s/AKfycbw8GVO1VqmhHyNhgoVr25lvkROu0D0lrqDA0RQqNQ0e3nxs8ZpJl_uXJe0XIvJjt-H1BQ/exec";
const API_KEY = "BTC1818";

const teams = {
  1:{ name:"Team Cooper" }, 2:{ name:"Team Enrique" }, 3:{ name:"Team Michael" },
  4:{ name:"Team Jono" }, 5:{ name:"Team Chung" }, 6:{ name:"Team Vignesh" }, 7:{ name:"Team Chris" }
};
const rounds = Array.from({length: 14}, (_, i) => ({
  r: i+1,
  m: [[1,6],[2,5],[3,4],[7,null], [4,2],[5,1],[6,7],[3,null], [2,7],[3,6],[4,5],[1,null], [5,3],[6,2],[7,1],[4,null], [3,1],[4,7],[5,6],[2,null], [6,4],[7,3],[1,2],[5,null], [7,5],[1,4],[2,3],[6,null]].slice(i*4, (i+1)*4)
}));

const rs = document.getElementById("roundSelect");
rounds.forEach(r => { let opt = document.createElement("option"); opt.value = r.r; opt.textContent = `Round ${r.r}`; rs.appendChild(opt); });

rs.onchange = () => {
  const ms = document.getElementById("matchSelect"); ms.innerHTML = "";
  rounds.find(x => x.r == rs.value).m.forEach((m, i) => {
    if (m[1]) { let opt = document.createElement("option"); opt.value = i; opt.textContent = `${teams[m[0]].name} vs ${teams[m[1]].name}`; ms.appendChild(opt); }
  });
};
rs.onchange();

document.getElementById("btnUnlock").onclick = () => {
  if (document.getElementById("gateCode").value === "BTC1818") {
    document.getElementById("gateArea").hidden = true;
    document.getElementById("adminArea").hidden = false;
  }
};

document.getElementById("btnLoad").onclick = () => {
  const r = rs.value; const mi = document.getElementById("matchSelect").value;
  const match = rounds.find(x => x.r == r).m[mi];
  const tA = match[0], tB = match[1];
  
  const pairs = ["12", "34", "13", "24", "14", "23"];
  document.getElementById("sheetHost").innerHTML = `
    <div class="card">
      <h3>${teams[tA].name} vs ${teams[tB].name}</h3>
      ${pairs.map(p => `<div class="score-grid"><span>Set ${p.split('').join('+')}</span><input type="number" class="sa" data-p="${p}" placeholder="Home"> <input type="number" class="sb" data-p="${p}" placeholder="Away"></div>`).join("")}
      <button class="btn" id="btnSave" style="margin-top:1rem">Save Scores</button>
    </div>
  `;

  document.getElementById("btnSave").onclick = async () => {
    const pData = {}; let sA = 0, sB = 0;
    document.querySelectorAll(".sa").forEach((el, i) => {
      const a = Number(el.value), b = Number(document.querySelectorAll(".sb")[i].value);
      pData[el.dataset.p] = { a, b }; if (a > b) sA++; else if (b > a) sB++;
    });
    const record = { r: Number(r), a: tA, b: tB, aSets: sA, bSets: sB, aPts: sA + (sA>sB?2:0), bPts: sB + (sB>sA?2:0), pairs: pData, ts: Date.now() };
    const res = await fetch(`${SHEETS_WEBAPP_URL}?action=upsert&key=${API_KEY}&matchKey=r${r}_m${mi}&record=${encodeURIComponent(JSON.stringify(record))}`);
    if (res.ok) alert("Saved!");
  };
};
</script>
</body>
</html>
