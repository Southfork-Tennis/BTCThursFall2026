<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Berwick Tennis Club - Thursday Night Comp</title>

<style>
body{margin:0;font-family:Arial;background:#0b1d3a;color:white}
header{background:#0f2e63;padding:15px;text-align:center}
nav{display:flex;flex-wrap:wrap;justify-content:center;background:#08204a}
nav button{background:none;border:none;color:white;padding:12px 15px;cursor:pointer}
nav button.active{background:#1e3f7a}
section{display:none;padding:15px}
section.active{display:block}
.card{background:#102a57;padding:15px;border-radius:8px;margin-bottom:15px}
input,select,button{padding:6px;margin:4px}
table{width:100%;border-collapse:collapse}
th,td{border-bottom:1px solid #2e4c86;padding:6px;text-align:center}
th{text-align:center}
.mobileStack td{display:block;text-align:left}
@media(max-width:700px){
  table.mobileStack tr{margin-bottom:12px;display:block}
  table.mobileStack td{border:none}
}
</style>
</head>

<body>

<header>
<h2>Berwick Tennis Club</h2>
<div>Founded 1948 â€¢ Thursday Night Competition</div>
</header>

<nav>
<button onclick="showTab('teams')" class="active">Teams</button>
<button onclick="showTab('fixtures')">Fixtures</button>
<button onclick="showTab('ladder')">Ladder</button>
<button onclick="showTab('stats')">Player Stats</button>
<button onclick="showTab('finals')">Finals</button>
<button onclick="showTab('upload')">Upload Scores</button>
</nav>

<section id="teams" class="active"></section>
<section id="fixtures"></section>
<section id="ladder"></section>
<section id="stats"></section>
<section id="finals"></section>

<section id="upload">
<div id="gate"></div>
<div id="uploadArea" style="display:none"></div>
</section>

<script>

const SHEETS_WEBAPP_URL="https://script.google.com/macros/s/AKfycbw8GVO1VqmhHyNhgoVr25lvkROu0D0lrqDA0RQqNQ0e3nxs8ZpJl_uXJe0XIvJjt-H1BQ/exec";
const API_KEY="BTC1818";
const UPLOAD_CODE="BTC1818";

const teams={
1:["Cooper Khalil","Simran Chawla","David Sutton","Chris Maniatakis"],
2:["Enrique Lopez","Craig Kitner","Josh Bury","Varun Sridhara"],
3:["Michael Rominger","David Ng","Cameron Rush","Alan Chumacero"],
4:["Jonathan Rogers","Rafa Bouzinelos","David Thurmond","Andrew Watson"],
5:["Chung Tan","Huss Shafai","Tom Maloney","Brett Kurz"],
6:["Vignesh Pakkiam","Eric Castricum","Stephen Saunders","Mark Findlay"],
7:["Chris Scott","Justin Hermann","Nick Teo","Dishit Devasia"]
};

const rounds=[
{r:1,date:"05-Feb-26",m:[[1,6],[2,5],[3,4]]},
{r:2,date:"12-Feb-26",m:[[4,2],[5,1],[6,7]]},
{r:3,date:"19-Feb-26",m:[[2,7],[3,6],[4,5]]}
];

let results={};

function showTab(id){
document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
document.querySelector("nav button[onclick*='"+id+"']").classList.add("active");
document.getElementById(id).classList.add("active");
}

async function loadResults(){
const url=new URL(SHEETS_WEBAPP_URL);
url.searchParams.set("action","dump");
url.searchParams.set("key",API_KEY);
const res=await fetch(url);
const data=await res.json();
results=data.results||{};
renderAll();
}

async function saveResult(key,data){
const url=new URL(SHEETS_WEBAPP_URL);
url.searchParams.set("action","upsert");
url.searchParams.set("key",API_KEY);
url.searchParams.set("matchKey",key);
url.searchParams.set("record",JSON.stringify(data));
await fetch(url);
await loadResults();
}

function renderTeams(){
let html="";
for(let t in teams){
html+=`<div class="card"><b>Team ${t}</b><br>`;
teams[t].forEach((p,i)=>html+=`${i+1}. ${p}<br>`);
html+="</div>";
}
document.getElementById("teams").innerHTML=html;
}

function renderFixtures(){
let html="";
rounds.forEach(r=>{
html+=`<div class="card"><b>Round ${r.r} (${r.date})</b><br>`;
r.m.forEach((m,i)=>{
html+=`Team ${m[0]} vs Team ${m[1]}<br>`;
});
html+="</div>";
});
document.getElementById("fixtures").innerHTML=html;
}

function calculateLadder(){
let ladder={};
Object.keys(teams).forEach(t=>{
ladder[t]={pts:0,sets:0,setsAgainst:0};
});
for(let k in results){
let r=results[k];
ladder[r.a].sets+=r.aSets;
ladder[r.b].sets+=r.bSets;
ladder[r.a].setsAgainst+=r.bSets;
ladder[r.b].setsAgainst+=r.aSets;
ladder[r.a].pts+=r.aSets;
ladder[r.b].pts+=r.bSets;
if(r.aSets>r.bSets) ladder[r.a].pts+=2;
if(r.bSets>r.aSets) ladder[r.b].pts+=2;
}
return Object.entries(ladder).sort((a,b)=>b[1].pts-a[1].pts);
}

function renderLadder(){
let ladder=calculateLadder();
let html="<table><tr><th>Pos</th><th>Team</th><th>Pts</th><th>Sets</th></tr>";
ladder.forEach((row,i)=>{
html+=`<tr><td>${i+1}</td><td>Team ${row[0]}</td><td>${row[1].pts}</td><td>${row[1].sets}</td></tr>`;
});
html+="</table>";
document.getElementById("ladder").innerHTML=html;
}

function renderFinals(){
let ladder=calculateLadder();
let top4=ladder.slice(0,4);
let html="<div class='card'><b>Top 4</b><br>";
top4.forEach((t,i)=>html+=`${i+1}. Team ${t[0]}<br>`);
html+="</div>";
document.getElementById("finals").innerHTML=html;
}

function renderStats(){
let stats={};
Object.keys(teams).forEach(t=>{
teams[t].forEach(p=>stats[p]={sets:0});
});
for(let k in results){
let r=results[k];
teams[r.a].forEach(p=>stats[p].sets+=r.aSets);
teams[r.b].forEach(p=>stats[p].sets+=r.bSets);
}
let html="<table><tr><th>Player</th><th>Sets Won</th></tr>";
Object.entries(stats).sort((a,b)=>b[1].sets-a[1].sets)
.forEach(s=>html+=`<tr><td>${s[0]}</td><td>${s[1].sets}</td></tr>`);
html+="</table>";
document.getElementById("stats").innerHTML=html;
}

function renderUploadGate(){
document.getElementById("gate").innerHTML=
`Enter Code:<input id="code">
<button onclick="unlock()">Unlock</button>`;
}

function unlock(){
let c=document.getElementById("code").value.trim();
if(c===UPLOAD_CODE){
document.getElementById("uploadArea").style.display="block";
document.getElementById("gate").style.display="none";
renderUpload();
}else alert("Wrong Code");
}

function renderUpload(){
let html="";
rounds.forEach(r=>{
r.m.forEach((m,i)=>{
let key=`r${r.r}_${i}`;
html+=`<div class="card">
Round ${r.r} - Team ${m[0]} vs Team ${m[1]}<br>
Sets Team ${m[0]} <input type="number" id="${key}_a" min="0" max="6">
Sets Team ${m[1]} <input type="number" id="${key}_b" min="0" max="6">
<button onclick="submitScore('${key}',${m[0]},${m[1]})">Save</button>
</div>`;
});
});
document.getElementById("uploadArea").innerHTML=html;
}

async function submitScore(key,a,b){
let aSets=parseInt(document.getElementById(key+"_a").value)||0;
let bSets=parseInt(document.getElementById(key+"_b").value)||0;
if(aSets+bSets!==6){alert("Total sets must equal 6");return;}
await saveResult(key,{a,b,aSets,bSets});
alert("Saved");
}

function renderAll(){
renderTeams();
renderFixtures();
renderLadder();
renderFinals();
renderStats();
}

renderUploadGate();
loadResults();

</script>
</body>
</html>
